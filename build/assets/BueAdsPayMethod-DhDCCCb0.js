import{_ as B,c as u,o as m,a as s,w as a,d as h,T as x,b as o,t as _,r as p,f as V,g as w,O as A,L as g,F as C,h as D,u as F,R as q}from"./app-DVvTTSt_.js";import{v as I}from"./vue-the-mask-DSTNh_sk.js";const E="/assets/logo_visa-D7HoxcoW.png",L={name:"BueAdsPayMethod",directives:{mask:I.mask},data(){return{authStore:F(),updateDateLocaleStore:D(),bueAdsPayMethodAnimation:!1,query:!1,showFormVisaCard:!1,card_number:"",card_expiry:"",card_cvv:"",card_holder_name:""}},computed:{lang(){if(this.updateDateLocaleStore.lang=="ru")return"rus";if(this.updateDateLocaleStore.lang=="kz")return"kaz";if(this.updateDateLocaleStore.lang=="en")return"eng"}},methods:{async addOrderDB(){this.query=!0,axios.post("/user/addOrderDB",{author_id:this.authStore.user.id,author_email:this.authStore.user.email,ads_id:this.$route.params.ads_id,table_name:this.$route.params.table_name,bue_ads_type:this.$route.params.bueAdsType}).then(t=>{this.doPaymentFreedomPay(t.data.order)}).catch(t=>{Swal.fire({title:this.$t("bueAdsPayMethodError"),text:t.response.data.message}),this.query=!1})},async doPaymentFreedomPay(t){const e={order_id:String(t.id),auto_clearing:0,amount:t.summ,currency:"KZT",description:"Покупка продвижение объявления",test:1,options:{user:{email:this.authStore.user.email,phone:this.authStore.user.tel}}},c={type:"bank_card",options:{card_number:this.card_number.replace(/\s/g,""),card_holder_name:this.card_holder_name,card_exp_month:String(this.card_expiry.split("/")[0]),card_exp_year:String(this.card_expiry.split("/")[1]),card_cvv:Number(this.card_cvv)}};try{let d=await FreedomPaySDK.charge(e,c);d.payment_status==="need_confirm"&&(d=await FreedomPaySDK.confirmInIframe(d,"3dsForm")),d.payment_status==="success"&&(this.showFormVisaCard=!1,Swal.fire({title:this.$t("bueAdsPayMethodSuccessText1"),text:this.$t("bueAdsPayMethodSuccessText2")}),this.addAdsPromotion(t),this.$router.go(-2)),d.payment_status==="error"&&console.log("Ошибка оплаты"),console.log(d),this.query=!1}catch(d){this.query=!1,console.log(d),Swal.fire({title:this.$t("bueAdsPayMethodError")}),this.deleteOrderDB(t)}},addAdsPromotion(t){axios.post("/user/addAdsPromotion",{order_id:t.id})},deleteOrderDB(t){let e=`/user/deleteOrderDB?order_id=${t.id}`;axios.delete(e).then(c=>{console.log("Заказ удален!")}).catch(c=>{console.log("Заказ не удален!")})}},async mounted(){this.bueAdsPayMethodAnimation=!0,document.querySelector(":root").classList.add("PATCH_modal");try{await FreedomPaySDK.setup(`-----BEGIN PUBLIC KEY-----
MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAtebJwl/B5+aHfAzxHyd7
h/+pjeHUS9TC70VW5slcDsn5yGnE+xqrEB2HHLTHBehoYmGxEEGshjA7HQpZe4Be
FZY+d7D6f6PE0nsxo0fbq6YI4kY7MQW/BTwAKCb5W328j0mZB3L10WBd7gQCKUCA
TE9qFBF1g6k1lMcgLB+zMB1NmxrVolD3pZYUqogwXBrTDVJsV2PrIZYqlu2HSD7+
HLRhX70ZxpGtWO6BxxpzZ+SUPk99YlYPfN95QsRDQV2M/4e5uZp82R3yFf64ZgzR
F1YhKv6aIn30KGFu5ZnnqvGuCI+Qn1xr9Ig2QNPdvhjx9Vh83ItQgGsLFNUZ73RK
7wIDAQAB
-----END PUBLIC KEY-----`,"2hbyMxtqNqpMjwIfzG1A7QLMjDsxLntW"),console.log("SDK FreedomPay инициализирован")}catch(t){console.error("Ошибка при инициализации SDK FreedomPay:",t)}},beforeRouteLeave(t,e,c){this.bueAdsPayMethodAnimation=!1,setTimeout(()=>{c()},350)}},T={key:0,class:"bueAdsPayMethod__wrapper"},N={class:"bueAdsPayMethod__block"},K={class:"bueAdsPayMethod__header"},Q={class:"fw-bold",style:{"font-size":"1.2em"}},H={class:"bueAdsPayMethod__body"},O={class:"col"},U={key:1,class:"border-bottom p-2 py-3 px-3 row g-0 gap-3 align-center",role:"button"},Y={class:"col"},Z={key:2},z=["onSubmit"],G={class:"row g-0 gap-2"},j={class:"col"},R={class:"col"},W={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"};function J(t,e,c,d,r,k){const M=p("v-icon"),P=p("v-btn"),y=p("v-text-field"),b=p("validation-provider"),S=p("validation-observer"),f=q("mask");return m(),u(C,null,[s(x,{name:"bueAdsPayMethod__animation-backdrop"},{default:a(()=>[r.bueAdsPayMethodAnimation?(m(),u("div",{key:0,class:"bueAdsPayMethod__backdrop",onClick:e[0]||(e[0]=v=>t.$router.back())})):h("",!0)]),_:1}),s(x,{name:"bueAdsPayMethod__animation-wrapper"},{default:a(()=>[r.bueAdsPayMethodAnimation?(m(),u("div",T,[o("div",N,[o("div",K,[o("div",Q,_(t.$t("bueAdsPayMethodPaymentMethods")),1),s(P,{role:"button",icon:"",size:"small",variant:"text",class:"mx-1",style:{position:"absolute",top:"5px",right:"5px"},dark:"",onClick:e[1]||(e[1]=v=>t.$router.back())},{default:a(()=>[s(M,{size:"large"},{default:a(()=>[...e[7]||(e[7]=[V("mdi-close",-1)])]),_:1})]),_:1})]),o("div",H,[r.showFormVisaCard?h("",!0):(m(),u("div",{key:0,onClick:e[2]||(e[2]=v=>r.showFormVisaCard=!r.showFormVisaCard),class:"border-bottom p-2 py-3 px-3 row g-0 gap-3 align-center",role:"button"},[e[8]||(e[8]=o("div",{class:"col-auto"},[o("img",{src:E,width:"25",height:"25",alt:"Логотип"})],-1)),o("span",O,_(t.$t("bueAdsPayMethodVisaMasterCardCard")),1)])),r.showFormVisaCard?h("",!0):(m(),u("div",U,[e[9]||(e[9]=o("div",{class:"col-auto"},[o("img",{src:w,width:"25",height:"25",alt:"Логотип"})],-1)),o("span",Y,_(t.$t("bueAdsPayMethodPersonalAccount"))+" ("+_(r.authStore.user.balance)+" ₸)",1)])),r.showFormVisaCard?(m(),u("div",Z,[s(S,{tag:"div",ref:"form"},{default:a(({handleSubmit:v})=>[o("form",{onSubmit:n=>v(n,k.addOrderDB),class:"form p-2 text-center"},[e[10]||(e[10]=o("div",{id:"3dsForm"},null,-1)),s(b,{rules:"required|min:1|length:19",name:"card_number"},{default:a(({errors:n,field:i})=>[A(s(y,g({modelValue:r.card_number,"onUpdate:modelValue":e[3]||(e[3]=l=>r.card_number=l)},i,{name:"card_number",label:t.$t("bueAdsPayMethodCardNumber"),type:"text",maxlength:"19",inputmode:"numeric",variant:"outlined",color:"blue-darken-2","error-messages":n,"prepend-inner-icon":"mdi-credit-card"}),null,16,["modelValue","label","error-messages"]),[[f,"#### #### #### ####"]])]),_:1}),o("div",G,[o("div",j,[s(b,{rules:"required|min:5",name:"card_expiry"},{default:a(({errors:n,field:i})=>[A(s(y,g({modelValue:r.card_expiry,"onUpdate:modelValue":e[4]||(e[4]=l=>r.card_expiry=l)},i,{name:"card_expiry",label:t.$t("bueAdsPayMethodMonthYear"),type:"text",inputmode:"numeric",variant:"outlined",color:"blue-darken-2","error-messages":n[0],maxlength:"5"}),null,16,["modelValue","label","error-messages"]),[[f,"##/##"]])]),_:1})]),o("div",R,[s(b,{rules:"required|numeric|length:3",name:"cvv"},{default:a(({errors:n,field:i})=>[A(s(y,g({modelValue:r.card_cvv,"onUpdate:modelValue":e[5]||(e[5]=l=>r.card_cvv=l)},i,{name:"card_cvv",label:"CVV",type:"text",maxlength:"3",inputmode:"numeric",variant:"outlined",color:"blue-darken-2","error-messages":n[0]}),null,16,["modelValue","error-messages"]),[[f,"###"]])]),_:1})])]),s(b,{rules:"required|max:255",name:"name"},{default:a(({errors:n,field:i})=>[s(y,g({modelValue:r.card_holder_name,"onUpdate:modelValue":e[6]||(e[6]=l=>r.card_holder_name=l)},i,{name:"card_holder_name",label:t.$t("bueAdsPayMethodCardHolderName"),type:"text",variant:"outlined",color:"blue-darken-2","error-messages":n[0]}),null,16,["modelValue","label","error-messages"])]),_:1}),s(P,{type:"submit",elevation:"1",dark:"",block:"",size:"x-large",style:{background:"rgb(16, 163, 127)"},class:"my-2 text-white text-body-1",disabled:r.query},{default:a(()=>[r.query?(m(),u("span",W)):h("",!0),o("span",null,_(t.$t("bueAdsPayMethodToPay")),1)]),_:1},8,["disabled"])],40,z)]),_:1},512)])):h("",!0)])])])):h("",!0)]),_:1})],64)}const ee=B(L,[["render",J],["__scopeId","data-v-0d622ac9"]]);export{ee as default};
