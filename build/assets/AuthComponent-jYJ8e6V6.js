import{g as E}from"./vform.es-B4KpagF-.js";import{A as T,B as D}from"./AlertError-DrRZYr7M.js";import{H as C}from"./HasError-OgLSLYZ-.js";import{_ as F,c as r,o,b as u,a as i,w as l,r as f,f as d,d as n,t as a,e as v,L,n as z,M as S,h as U,N as I,u as N}from"./app-DVvTTSt_.js";import{c as M}from"./vue-tel-input-neGMhw29.js";const H={name:"AuthComponent",components:{Button:D,HasError:C,AlertError:T,VueTelInput:M},data(){return{authStore:N(),getProjectDataStore:I(),updateDateLocaleStore:U(),form_name:"login",show_password:!1,query:!1,form:new E({name:"",email:"",tel:"",password:"",agree:!0,recaptcha_token:"",path:this.$route.path}),success:"",error:"",telValid:!1,showTelErrorMessage:!1}},computed:{formName(){if(this.form_name=="login")return this.$t("authLogin");if(this.form_name=="register")return this.$t("authSignUp");if(this.form_name=="sendLinkForgotPassword")return this.$t("authRecoverPassword");if(this.form_name=="resetPassword")return this.$t("authChangePassword");if(this.form_name=="sendLinkEmailVerification"||this.form_name=="accountActivation")return this.$t("authAccountActivation")}},methods:{async submit(){if(this.query=!0,this.form_name=="register")if(this.telValid!=!0){this.showTelErrorMessage=!0,this.query=!1;return}else this.showTelErrorMessage=!1;this.$recaptchaLoaded().then(()=>{this.$recaptcha("login").then(t=>{this.form.recaptcha_token=t,this.form_name=="login"&&this.login(),this.form_name=="register"&&this.register(),this.form_name=="sendLinkForgotPassword"&&this.sendLinkForgotPassword(),this.form_name=="resetPassword"&&this.resetPassword(),this.form_name=="sendLinkEmailVerification"&&this.sendLinkEmailVerification()}).catch(()=>{this.query=!1,Swal.fire({text:this.$t("authError")})})}).catch(()=>{this.query=!1,Swal.fire({text:this.$t("authError")})})},login(){axios.get("/sanctum/csrf-cookie").then(t=>{this.form.post("/auth/login").then(s=>{this.query=!1,this.authStore.getUser(),this.$router.back()}).catch(s=>{this.query=!1,this.error=s.response.data.error})})},register(){this.form.post("/auth/register").then(t=>{this.query=!1,this.success="Регистрация завершена!"}).catch(t=>{this.query=!1,this.error=this.$t("authError")})},sendLinkForgotPassword(){axios.post("/auth/sendLinkForgotPassword",{email:this.form.email,path:this.$route.path,recaptcha_token:this.form.recaptcha_token}).then(t=>{this.query=!1,this.success="Письмо для смены пароля отправленно!"}).catch(t=>{this.query=!1,this.error=t.response.data.error})},resetPassword(){this.form.token=this.$route.query.resetPasswordToken,axios.get("/sanctum/csrf-cookie").then(t=>{this.form.post("/auth/resetPassword").then(s=>{this.query=!1,this.authStore.getUser(),this.$router.replace("/allAds/Kvartira")}).catch(s=>{this.query=!1,Toast.fire({text:s.response.data.error})})})},sendLinkEmailVerification(){this.form.post("/auth/sendLinkEmailVerification").then(t=>{this.query=!1,this.success="Письмо для активации аккаунта отправлено!"}).catch(t=>{this.query=!1,this.error=t.response.data.error})},async accountActivation(t){axios.get("/sanctum/csrf-cookie").then(s=>{this.$recaptchaLoaded().then(()=>{this.$recaptcha("login").then(p=>{this.query=!0,axios.put("/auth/emailVerification",{recaptcha_token:p,account_activation_token:t}).then(g=>{this.query=!1,this.authStore.getUser(),this.$router.replace("/allAds/Kvartira")}).catch(g=>{this.query=!1,Toast.fire({text:g.response.data.error})})}).catch(()=>{this.query=!1,Swal.fire({text:this.$t("authError")})})}).catch(()=>{this.query=!1,Swal.fire({text:this.$t("authError")})})})},showForm(t="login"){this.form_name=t,this.error="",this.success="",this.query=!1,this.form.reset(),this.form.clear(),this.$refs.form.resetForm()},async googleAuth(t){let s="",p="",g="";t.credential?(s=S(t.credential).email,p=S(t.credential).given_name):g=t.access_token,this.query=!0,axios.get("/sanctum/csrf-cookie").then(e=>{axios.post("/auth/googleLogin",{token:g,email:s,name:p}).then(c=>{this.query=!1,this.authStore.getUser(),this.$router.back()}).catch(c=>{this.query=!1,this.error=c.response.data.error})})}},mounted(){let t=this;document.querySelector(":root").classList.add("PATCH_modal"),t.$route.query.resetPasswordToken!=null?t.showForm("resetPassword"):t.$route.query.accountActivationToken!=null?(this.form_name="accountActivation",t.accountActivation(t.$route.query.accountActivationToken)):t.showForm()},beforeRouteLeave(t,s,p){t.name=="allAds"&&document.querySelector(":root").classList.remove("PATCH_modal"),p()}},B={class:"auth__wrapper"},R={class:"auth__block"},Y={class:"auth__header"},G={class:"auth__body"},O={key:0,class:"mt-5 mx-auto text-center rounded border",style:{"max-width":"450px","font-size":"1.1em"}},K={key:0},j={class:"text-button fw-bold",style:{"font-size":"1.3em!important"}},W=["innerHTML"],J={key:1,class:"py-2"},Q={class:"mx-auto rounded-lg auth_card p-3",style:{"max-width":"450px"}},X={class:"my-2 text-center fw-bold mb-4"},Z={key:0},$={key:1},ee={key:2},te={key:3},oe={key:4},re={key:0,class:"alert bg-red text-center col-12 my-2",role:"alert"},se={key:0},ne={key:1},ae={key:0},ie={key:1},le={key:2},ue={key:2},me={key:0},ce={key:1},he={key:2},de={key:3},fe={key:0},pe={key:1},_e={key:2},ge={key:4},ke={key:0},ye={key:1},ve={key:2},we={key:5},be={key:0},Le={key:1},xe={key:2},Se={key:6},qe={key:1,class:"text-center col-12"},Ve={class:"h4 section-title"},Pe=["onSubmit"],Ae={key:2,class:"mb-4"},Ee={key:0,class:"text-caption mt-1 text-error"},Te={key:4,class:"mb-2 text-right"},De={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},Ce={key:5,class:"text-caption text-grey py-2"},Fe={key:3,class:"text-center my-2"},ze={key:4,class:"text-center my-2"},Ue={class:"text-center my-2"};function Ie(t,s,p,g,e,c){const x=f("v-icon"),_=f("v-btn"),w=f("v-text-field"),b=f("validation-provider"),q=f("vue-tel-input"),V=f("router-link"),P=f("validation-observer"),A=f("GoogleLogin");return o(),r("div",B,[u("div",R,[u("div",Y,[i(_,{icon:"",variant:"text",class:"mx-1",dark:"",onClick:s[0]||(s[0]=k=>t.$router.back())},{default:l(()=>[i(x,{size:"large"},{default:l(()=>[...s[11]||(s[11]=[d("mdi-arrow-left",-1)])]),_:1})]),_:1})]),u("div",G,[e.success!=""?(o(),r("div",O,[e.success=="Регистрация завершена!"||e.success=="Письмо для активации аккаунта отправлено!"||e.success=="Письмо для смены пароля отправленно!"?(o(),r("div",K,[u("div",j,a(t.$t("authLetterSent1")),1),u("div",null,a(t.$t("authLetterSent2")),1),u("small",{class:"text-center text-grey",innerHTML:t.$t("authLetterSent3")},null,8,W)])):n("",!0)])):n("",!0),e.success==""?(o(),r("div",J,[u("div",Q,[u("div",X,[e.form_name=="login"?(o(),r("h1",Z,a(t.$t("authWelcome")),1)):n("",!0),e.form_name=="register"?(o(),r("h1",$,a(t.$t("authCreateAnAccount")),1)):n("",!0),e.form_name=="sendLinkForgotPassword"?(o(),r("h1",ee,a(t.$t("authRecoverPassword")),1)):n("",!0),e.form_name=="resetPassword"?(o(),r("h1",te,a(t.$t("authChangePassword")),1)):n("",!0),e.form_name=="sendLinkEmailVerification"||e.form_name=="accountActivation"?(o(),r("h1",oe,a(t.$t("authAccountActivation")),1)):n("",!0)]),e.error!=""?(o(),r("div",re,[e.error=="Email не подтвержден"?(o(),r("div",se,[u("div",null,a(t.$t("authYouHavenVerifiedYourEmailYet")),1),i(_,{color:"blue-darken-1",onClick:s[1]||(s[1]=k=>c.showForm("sendLinkEmailVerification"))},{default:l(()=>[d(a(t.$t("authConfirm")),1)]),_:1})])):e.error=="Вы ввели неправильный пароль"?(o(),r("div",ne,[e.updateDateLocaleStore.lang=="ru"?(o(),r("span",ae,"Вы ввели неправильный пароль")):n("",!0),e.updateDateLocaleStore.lang=="kz"?(o(),r("span",ie,"Сіз қате құпия сөзді енгіздіңіз")):n("",!0),e.updateDateLocaleStore.lang=="en"?(o(),r("span",le,"You entered the wrong password")):n("",!0)])):e.error=="Пользователь с таким email еще не зарегистрирован"?(o(),r("div",ue,[e.updateDateLocaleStore.lang=="ru"?(o(),r("span",me,"Пользователь с таким email еще не зарегистрирован")):n("",!0),e.updateDateLocaleStore.lang=="kz"?(o(),r("span",ce,"Осы электрондық поштасы бар пайдаланушы әлі тіркелмеген")):n("",!0),e.updateDateLocaleStore.lang=="en"?(o(),r("span",he,"User with this email is not registered yet")):n("",!0)])):e.error=="Неверная капча - перезагрузите страницу"?(o(),r("div",de,[e.updateDateLocaleStore.lang=="ru"?(o(),r("span",fe,"Неверная капча - перезагрузите страницу")):n("",!0),e.updateDateLocaleStore.lang=="kz"?(o(),r("span",pe,"Жарамсыз captcha - бетті қайта жүктеңіз")):n("",!0),e.updateDateLocaleStore.lang=="en"?(o(),r("span",_e,"Invalid captcha - reload the page")):n("",!0)])):e.error=="Вы уже активировали аккаунт. Попробуйте войти на сайт"?(o(),r("div",ge,[e.updateDateLocaleStore.lang=="ru"?(o(),r("span",ke,"Вы уже активировали аккаунт. Попробуйте войти на сайт")):n("",!0),e.updateDateLocaleStore.lang=="kz"?(o(),r("span",ye,"Сіз өзіңіздің есептік жазбаңызды әлдеқашан белсендірдіңіз. Жүйеге кіріп көріңіз")):n("",!0),e.updateDateLocaleStore.lang=="en"?(o(),r("span",ve,"You have already activated your account. Try to login")):n("",!0)])):e.error=="Ссылка устарела, запросите новую ссылку для сменя пароля"?(o(),r("div",we,[e.updateDateLocaleStore.lang=="ru"?(o(),r("span",be,"Ссылка устарела, запросите новую ссылку для сменя пароля")):n("",!0),e.updateDateLocaleStore.lang=="kz"?(o(),r("span",Le,"Сілтеменің мерзімі өтті, құпия сөзді қалпына келтіру үшін жаңа сілтемені сұраңыз")):n("",!0),e.updateDateLocaleStore.lang=="en"?(o(),r("span",xe,"Link expired, please request a new link to reset your password")):n("",!0)])):(o(),r("div",Se,a(e.error),1))])):n("",!0),e.form_name=="accountActivation"&&e.error==""?(o(),r("div",qe,[s[12]||(s[12]=u("span",{class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},null,-1)),u("div",Ve,a(t.$t("authAccountActivationProcess")),1)])):(o(),v(P,{key:2,tag:"div",ref:"form"},{default:l(({handleSubmit:k})=>[u("form",{onSubmit:m=>k(m,c.submit),class:"form py-2 text-center"},[e.form_name=="register"?(o(),v(b,{key:0,rules:"required|alpha|max:15",name:"name"},{default:l(({errors:m,field:y})=>[i(w,L({modelValue:e.form.name,"onUpdate:modelValue":s[2]||(s[2]=h=>e.form.name=h)},y,{name:"name",label:t.$t("authLableName"),type:"text",maxlength:"15",variant:"outlined",color:"blue-darken-2","error-messages":e.form.errors.has("name")?e.form.errors.get("name"):m[0],onInput:h=>e.form.errors.clear("name")}),null,16,["modelValue","label","error-messages","onInput"])]),_:1})):n("",!0),e.form_name=="login"||e.form_name=="register"||e.form_name=="sendLinkForgotPassword"||e.form_name=="sendLinkEmailVerification"?(o(),v(b,{key:1,rules:"required|email|max:255",name:"email"},{default:l(({errors:m,field:y})=>[i(w,L({modelValue:e.form.email,"onUpdate:modelValue":s[3]||(s[3]=h=>e.form.email=h)},y,{name:"email",label:t.$t("authLableEmail"),hint:e.form_name=="sendLinkForgotPassword"||e.form_name=="sendLinkEmailVerification"?"Введите email который вы указывали при регистрации":"",type:"email",inputmode:"email",variant:"outlined",color:"blue-darken-2","error-messages":e.form.errors.has("email")?e.form.errors.get("email"):m[0],onInput:h=>e.form.errors.clear("email")}),null,16,["modelValue","label","hint","error-messages","onInput"])]),_:1})):n("",!0),e.form_name=="register"?(o(),r("div",Ae,[i(q,{modelValue:e.form.tel,"onUpdate:modelValue":s[4]||(s[4]=m=>e.form.tel=m),onValidate:s[5]||(s[5]=m=>e.telValid=m.valid),style:{height:"56px"},inputOptions:{placeholder:t.$t("authLableTel"),showDialCode:!0},class:z({"border border-danger":e.showTelErrorMessage!=""}),validCharactersOnly:!0},null,8,["modelValue","inputOptions","class"]),e.showTelErrorMessage?(o(),r("div",Ee,a(t.$t("authLableTel")),1)):n("",!0)])):n("",!0),e.form_name=="login"||e.form_name=="register"||e.form_name=="resetPassword"?(o(),v(b,{key:3,rules:"required|min:6|max:30",name:"password"},{default:l(({errors:m,field:y})=>[i(w,L({modelValue:e.form.password,"onUpdate:modelValue":s[6]||(s[6]=h=>e.form.password=h)},y,{name:"password",label:t.$t("authLablePassword"),type:e.show_password?"text":"password",maxlength:"30",autocomplete:"off",variant:"outlined",color:"blue-darken-2","append-inner-icon":e.show_password?"mdi-eye-outline":"mdi-eye-off-outline","onClick:appendInner":s[7]||(s[7]=h=>e.show_password=!e.show_password),"error-messages":e.form.errors.has("password")?e.form.errors.get("password"):m[0],onInput:h=>e.form.errors.clear("password")}),null,16,["modelValue","label","type","append-inner-icon","error-messages","onInput"])]),_:1})):n("",!0),e.form_name=="login"?(o(),r("div",Te,[i(_,{variant:"text",color:"blue-darken-2",class:"text-body-2",onClick:s[8]||(s[8]=m=>c.showForm("sendLinkForgotPassword"))},{default:l(()=>[d(a(t.$t("authIDoNotRememberThePassword")),1)]),_:1})])):n("",!0),i(_,{type:"submit",elevation:"1",dark:"",block:"",size:"x-large",style:{background:"rgb(16, 163, 127)"},class:"my-2 text-white text-body-1",disabled:e.query},{default:l(()=>[e.query?(o(),r("span",De)):n("",!0),u("span",null,a(c.formName),1)]),_:1},8,["disabled"]),e.form_name=="register"?(o(),r("div",Ce,[d(a(t.$t("authRulesText"))+" ",1),i(V,{tag:"a",to:"/polzovatelskoeSoglashenie",target:"_blank"},{default:l(()=>[d(a(t.$t("authUserAgreement")),1)]),_:1})])):n("",!0)],40,Pe)]),_:1},512)),e.form_name!="login"?(o(),r("div",Fe,[i(_,{onClick:s[9]||(s[9]=k=>c.showForm("login")),block:"",color:"blue",class:"text-body-1",size:"x-large",variant:"outlined"},{default:l(()=>[d(a(t.$t("authLogin")),1)]),_:1})])):n("",!0),e.form_name!="register"?(o(),r("div",ze,[i(_,{onClick:s[10]||(s[10]=k=>c.showForm("register")),block:"",color:"blue",class:"text-body-1",size:"x-large",variant:"outlined"},{default:l(()=>[d(a(t.$t("authSignUp")),1)]),_:1})])):n("",!0),u("div",Ue,[i(A,{callback:c.googleAuth,"popup-type":"TOKEN",prompt:"",style:{width:"100%"}},{default:l(()=>[i(_,{variant:"outlined",block:"",class:"google-login-button",size:"x-large"},{default:l(()=>[i(x,{class:"google-icon"},{default:l(()=>[...s[13]||(s[13]=[d("mdi-google",-1)])]),_:1}),d(" "+a(t.$t("authGoogleLogin")),1)]),_:1})]),_:1},8,["callback"])])])])):n("",!0)])])])}const Ye=F(H,[["render",Ie],["__scopeId","data-v-d7a8429c"]]);export{Ye as default};
