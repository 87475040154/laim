import{_ as b,c as d,o as a,b as i,a as l,r as n,d as h,e as y,n as k,t as r,f as u,w as c,g as M,F as S,u as p,h as w,i as F}from"./app-DVvTTSt_.js";import{u as I}from"./Filter-LS5lWy04.js";import{u as C}from"./KZLocation-DLYATfpV.js";import{a as B}from"./AdsPreviewComponent-CHZfV-Gy.js";import"./images-DnLiIPx2.js";import"./ads-DDty5fC4.js";const D={name:"IndexComponent",components:{adsPreviewComponent:B},data(){return{authStore:p(),appInstallStore:F(),filterStore:I(),updateDateLocaleStore:w(),KZLocationStore:C(),query:!1,controller:null,topPanelFixed:!1,showBtnAppInstall:!1,count_ads:0,ads_arr:[],getMyLikeAds:!1,countFilter:0,showMapButton:!1,nextCursor:null,isFirstLoad:!0,isLastLoad:!1}},watch:{$route(e,t){e.name=="allAds"&&t.name=="allAds"&&(this.clearData(),this.getAds())},"filterStore.make_filter"(){this.clearData(),this.getAds()}},methods:{async getAds(){if(this.isLastLoad)return;this.controller&&this.controller.abort(),this.controller=new AbortController;const e=this.controller.signal,t=setTimeout(()=>{this.query=!0},200);this.authStore.check||(this.getMyLikeAds=!1),this.showBtnAppInstall=!1;try{const o=await axios.get("getAllAds",{params:{cursor:this.nextCursor,user_id:p().check?p().user.id:0,table_name:this.$route.params.table_name,filter:JSON.parse(localStorage.getItem("filter="+this.$route.params.table_name))||{},getMyLikeAds:this.getMyLikeAds?"Получить мои лайки":"Не получать мои лайки"},signal:e});this.ads_arr=this.isFirstLoad?o.data.ads.data:[...this.ads_arr,...o.data.ads.data],this.isFirstLoad&&this.countAds(),this.nextCursor=o.data.ads.next_cursor,this.isLastLoad=this.nextCursor===null,this.filterLength(),this.isFirstLoad=!1}catch(o){o.name!=="CanceledError"&&console.error(o)}finally{clearTimeout(t),this.query=!1}},getMyLike(){this.getMyLikeAds=!this.getMyLikeAds,this.getMyLikeAds?localStorage.setItem("getMyLikeAds",!0):localStorage.removeItem("getMyLikeAds"),this.clearData(),this.getAds()},filterLength(){let e=JSON.parse(localStorage.getItem("filter="+this.$route.params.table_name));if(e==null){this.countFilter=0,this.showMapButton=!1;return}let t=0;for(let o in e)o!="originalData"&&o!="busy"&&o!="successful"&&o!="recentlySuccessful"&&o!="recentlySuccessfulTimeoutId"&&o!="errors"&&o!="progress"&&e[o]!=""&&e[o]!=null&&(t+=1);t>0?(e.oblast!=null?(e.gorod!=null&&(t-=1),e.raion!=null&&(t-=1),this.showMapButton=!0):this.showMapButton=!1,this.countFilter=t):(this.countFilter=t,this.showMapButton=!1)},countAds(){axios.get("countAds",{params:{user_id:p().check?p().user.id:0,table_name:this.$route.params.table_name,filter:JSON.parse(localStorage.getItem("filter="+this.$route.params.table_name))??"Фильтр не применен",getMyLikeAds:this.getMyLikeAds?"Получить мои лайки":"Не получать мои лайки"}}).then(e=>{this.count_ads=e.data.countAds,this.count_ads>0&&(this.showBtnAppInstall=!0)})},clearData(){this.ads_arr=[],this.nextCursor=null,this.isFirstLoad=!0,this.isLastLoad=!1}},mounted(){let e=0;window.addEventListener("scroll",()=>{const t=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0;t>500?t<e?this.topPanelFixed=t<e:this.topPanelFixed=!1:t>e&&(this.topPanelFixed=!1),e=t}),localStorage.getItem("getMyLikeAds")!=null&&(this.getMyLikeAds=!0),this.getAds()}},q={style:{position:"relative","z-index":"2"}},N={class:"index__page"},T={class:"container-lg"},P={class:"index-page__top-panel my-4"},$={key:1,class:"bi bi-hdd-stack-fill"},O={key:0,class:"d-flex justify-content-center py-1"},E={key:1,class:"text-center text-muted my-3"},V={key:2,class:"m-3 mx-sm-auto",style:{"max-width":"600px"}};function G(e,t,o,J,s,f){const A=n("router-view"),L=n("v-badge"),g=n("v-tooltip"),v=n("v-icon"),x=n("ads-preview-component"),_=n("v-btn");return a(),d(S,null,[i("div",q,[l(A)]),i("div",N,[i("div",{class:k({"index-page__top-panel-fixed":s.topPanelFixed})},[i("div",T,[i("div",P,[i("div",null,r(e.$t("indexFound"))+" "+r(s.count_ads),1),i("div",{onClick:t[0]||(t[0]=m=>e.$router.push({name:"filter"})),role:"button"},[u(r(e.$t("indexFilter"))+" ",1),s.countFilter>0?(a(),y(L,{key:0,floating:"",content:s.countFilter,color:"error"},{default:c(()=>[...t[4]||(t[4]=[i("i",{class:"bi bi-hdd-stack-fill"},null,-1)])]),_:1},8,["content"])):(a(),d("i",$)),l(g,{activator:"parent",location:"bottom"},{default:c(()=>[u(r(e.$t("indexMakeFilter")),1)]),_:1})]),i("div",null,[l(v,{onClick:t[1]||(t[1]=m=>s.authStore.check?f.getMyLike():e.$router.push({name:e.$route.name+"Auth"})),icon:s.getMyLikeAds?"mdi-heart":"mdi-heart-outline",class:k([{"text-red":s.getMyLikeAds},"icon__heart"])},null,8,["icon","class"]),l(g,{activator:"parent",location:"bottom"},{default:c(()=>[u(r(e.$t("indexMyFavorites")),1)]),_:1})])])])],2),l(x,{ads_arr:s.ads_arr,getMyLikeAds:s.getMyLikeAds,"parent-query":s.query,"is-last-load":s.isLastLoad,onGetAds:f.getAds},null,8,["ads_arr","getMyLikeAds","parent-query","is-last-load","onGetAds"]),s.query?(a(),d("div",O,[...t[5]||(t[5]=[i("div",{class:"spinner-border spinner-border-sm",style:{color:"var(--app-text-color)"},role:"status"},null,-1)])])):h("",!0),s.count_ads==0&&!s.query?(a(),d("div",E,[i("h4",null,r(e.$t("indexAdsNotFound")),1)])):h("",!0),s.appInstallStore.app!=""&&s.showBtnAppInstall&&e.$route.name=="allAds"?(a(),d("div",V,[l(_,{onClick:t[2]||(t[2]=m=>s.appInstallStore.install()),block:"",color:"white",class:"text-body-2"},{default:c(()=>[t[6]||(t[6]=i("img",{src:M,width:"25",height:"25",alt:"logo",class:"rounded-3"},null,-1)),u(" "+r(e.$t("indexInstallLime")),1)]),_:1})])):h("",!0),s.showMapButton?(a(),y(_,{key:3,rounded:"xl",height:"45",class:"text-caption mb-5 mb-lg-0 text-dark",style:{position:"fixed",bottom:"22px",right:"20px",background:"#ffdb4d"},onClick:t[3]||(t[3]=m=>e.$router.push({name:"allAdsMap"}))},{default:c(()=>[t[7]||(t[7]=i("i",{class:"bi bi-geo-alt px-1"},null,-1)),u(" "+r(e.$t("indexOnTheMap")),1)]),_:1})):h("",!0)])],64)}const H=b(D,[["render",G],["__scopeId","data-v-ece45ee7"]]);export{H as default};
